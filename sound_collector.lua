check_list_data = {
   MegaMan1={
      initial={
         "0_",
      },
      choose_screen={
         "0_213_269_359_269_213_269_359_",
         "213_269_359_269_213_269_359_0_213_0_359_",
         "0_213_269_359_269_213_269_359_0_",
         "213_269_359_0_213_0_359_0_240_269_359_",
      },
      choose_robotmaster={
         "25_285_53_23_285_53_21_285_53_285_30_285_26_",
         "23_285_53_21_285_53_285_30_285_26_28_285_26_",
         "21_285_53_285_30_285_26_28_285_26_26_285_26_",
      },
      cutman={
         "5_169_682_269_5_169_685_269_5_169_682_269_5_169_679_269_5_169_676_269_",
         "0_5_169_682_269_5_169_685_269_5_169_682_269_5_169_679_269_",
         "379_252_0_5_169_682_269_5_169_685_269_5_169_682_269_",
         "5_505_285_5_508_285_5_511_285_5_514_285_5_511_285_",
         "5_508_285_5_511_285_5_514_285_5_511_285_0_",
      },
      gutsman={
         "6_381_381_427_381_381_381_427_0_6_302_381_381_",
         "381_381_427_0_6_302_381_381_381_381_381_427_",
         "5_381_427_0_6_302_381_381_",
         "238_571_287_240_0_285_6_242_285_283_6_240_285_285_6_238_285_287_",
         "6_242_571_283_6_240_571_285_6_238_571_287_238_0_287_6_242_0_287_",
         "6_192_285_242_6_190_285_240_6_188_285_238_6_190_285_240_6_192_285_242_"
      },
      elecman={
         "456_503_550_597_644_",
         "5_0_5_174_5_221_5_268_5_315_",
         "5_174_5_221_5_268_5_315_362_",
         "5_179_453_226_5_180_453_227_5_181_453_228_5_180_453_227_5_179_453_226_",
         "302_0_5_179_453_226_5_180_453_227_5_181_453_228_",
         "5_179_453_226_5_178_453_225_178_453_225_177_0_224_177_302_224_",
      },
      iceman={
         "300_315_0_335_",
         "442_457_0_213_427_427_",
         "213_427_427_427_213_427_339_0_427_320_",
         "5_240_480_320_5_239_480_320_5_238_480_320_239_480_320_5_239_480_320_",
         "240_480_480_238_480_480_240_480_480_242_480_480_240_480_",
         "239_0_320_240_320_241_320_242_320_241_320_",
      },
      fireman={
         "110_125_0_157_",
         "15_0_51_15_641_32_641_13_641_6_641_",
         "302_302_254_302_0_6_302_641_0_6_339_679_",
         "403_641_403_0_5_403_302_254_5_0_5_453_641_",
         "5_0_5_453_641_453_0_453_121_115_453_142_130_",
      },
      bombman={
         "403_0_3_403_3_0_3_403_",
         "0_9_160_0_201_9_160_403_201_160_403_201_0_",
         "379_252_0_403_0_3_403_",
         "269_403_320_269_0_320_3_269_403_320_269_0_320_3_269_403_320_",
         "3_0_3_302_403_359_302_403_359_0_3_269_403_320_",
         "269_0_320_3_269_403_320_0_3_320_0_403_3_0_",
      },
      hopsh={
         "58_0_41_57_0_40_56_0_39_55_0_38_54_0_37_",
         "66_0_49_65_0_48_64_0_47_63_0_46_62_0_45_",
         "53_0_36_52_0_35_0_66_0_49_65_0_48_",
      },
      wily_stage_1={
         --1, 2 stages
         "302_0_254_302_302_0_5_254_302_302_",
         "254_302_302_0_5_254_302_302_5_302_5_226_302_269_",
         "226_302_269_226_0_269_226_302_269_302_0_",
         "5_226_302_269_226_302_269_226_0_269_226_302_269_302_",
         "5_302_5_226_302_269_226_302_269_226_0_269_226_302_269_"
      },
      wily_stage_2={
         "571_571_381_572_571_382_573_571_383_572_571_382_572_0_382_",
         "573_571_383_572_571_382_572_0_382_571_285_381_570_285_380_",
         "5_570_381_380_5_571_381_381_5_572_381_382_573_381_383_573_0_383_",
         "0_127_0_571_571_381_572_571_382_573_571_383_",
         "0_142_0_0_127_0_571_571_381_",
         "570_571_380_571_571_381_572_571_382_572_0_382_573_285_383_",
      },

      robotmaster_fight={
         --cutman
         "720_721_719_721_720_720_679_721_",
         "679_721_680_721_680_681_679_681_680_",
         "681_679_681_680_680_719_681_720_681_",
         --elecman
         "721_0_719_721_0_720_0_720_679_0_721_680_0_721_",
         "679_0_721_680_0_721_680_0_681_0_679_681_0_680_",
         "681_0_679_681_0_680_0_680_719_0_681_720_0_681_",
         --iceman
         "607_605_607_606_606_719_607_720_607_",
         "720_571_721_572_721_572_573_571_",
         "571_721_572_721_572_573_571_573_572_",
         --fireman
         "540_538_540_539_539_719_540_720_540_",
         "509_510_508_510_509_509_719_510_",
         --bombman
         "721_0_719_721_0_720_0_720_605_0_721_606_0_721_",
         "607_0_605_607_0_606_0_606_719_0_607_720_0_607_",
      },
      wily_fight={
         --stage_1
         "168_381_253_381_191_381_255_192_381_256_191_381_255_",
         "381_191_381_255_192_381_256_191_381_255_190_381_254_",
         "191_381_255_192_381_256_191_381_255_190_381_254_189_381_253_",
         --stage_2
         "169_381_254_168_381_253_381_191_381_255_192_381_256_",
         "191_381_255_190_381_254_189_381_253_381_170_381_255_",
         "171_381_256_170_381_255_169_381_254_168_381_253_381_",
         --stage_3
         "169_381_254_168_381_253_381_161_381_191_162_381_192_",
         "161_381_191_162_381_192_161_381_191_160_381_190_159_381_189_",
         "170_381_255_169_381_254_168_381_253_381_161_381_191_",
         --stage_4
         "190_381_254_189_381_253_381_170_381_255_171_381_256_",
         "5_256_381_322_5_255_381_321_5_254_381_320_5_253_381_319_5_381_",
      },
      victory={
         --cutman
         "5_188_339_5_186_339_5_184_339_5_339_5_149_339_149_",
         "5_184_339_5_339_5_149_339_149_147_339_147_145_339_145_",
         --gutsman
         "5_69_339_184_5_339_149_339_149_5_147_339_147_5_145_339_145_",
         --elecman
         "5_184_339_5_339_149_339_149_147_339_147_145_339_145_",
         "91_339_73_89_339_71_339_5_73_339_188_5_71_339_186_",
         --iceman
         "145_339_145_339_125_339_61_123_339_59_121_339_57_",
         "5_339_5_93_339_75_5_91_339_73_5_89_339_71_339_269_",
         --fireman
         "89_339_71_339_5_73_339_188_5_71_339_186_5_69_339_184_",
         "339_269_5_679_339_269_5_679_339_5_339_339_5_538_339_339_",
         --bombman
         "0_89_0_5_188_339_5_186_339_5_184_339_",
         "0_5_188_339_5_186_339_5_184_339_5_339_",
         --wily_stage_1_2
         "369_0_335_416_0_382_0_5_169_339_339_84_",
         "5_169_339_339_84_226_339_84_226_339_226_339_113_",
         --wily_stage_3
         "5_169_427_5_169_427_106_427_106_5_169_427_5_169_427_106_",
         "5_169_427_106_169_427_106_5_169_427_106_0_106_5_151_381_",
      },
      wily_defeated={
         "403_201_403_269_403_320_403_453_403_",
         "201_403_269_403_320_403_453_403_269_403_403_",
         "339_403_201_403_226_403_320_403_201_403_269_",
      },
      ending={
         "120_302_201_120_302_200_120_302_201_120_302_202_120_302_201_",
         "120_302_202_120_302_201_120_302_200_120_302_201_120_302_202_",
         "120_302_201_120_302_200_120_302_120_302_152_121_302_151_",
         '121_302_150_120_302_151_120_302_152_119_302_151_119_302_150_',
      },
   },
}



local function get_sound_data(data)
   result = ""
   if data["noise"]["volume"] > 0 then
      result = result..data["noise"]["regs"]["frequency"].."_"
   end
   if data["square1"]["volume"] > 0 then
      result = result..data["square1"]["regs"]["frequency"].."_"
   end
   if data["dpcm"]["volume"] > 0 then
      result = result..data["dpcm"]["regs"]["frequency"].."_"
   end
   if data["triangle"]["volume"] > 0 then
      result = result..data["triangle"]["regs"]["frequency"].."_"
   end
   if data["square2"]["volume"] > 0 then
      result = result..data["square2"]["regs"]["frequency"].."_"
   end
   return result
end


debug_sound_data = true
current_level = ""
current_sound_data_line = ""
prev_value = ""
current_data = {"", "", "", "", ""}
check_list = check_list_data[rom.getfilename()]

while true do
   emu.frameadvance()
   a = sound.get()["rp2a03"]
   sound_data = get_sound_data(a)
   
   if sound_data ~= prev_value then
      table.insert(current_data, sound_data)
      table.remove(current_data, 1)
      current_sound_data_line = table.concat(current_data)

      if debug_sound_data then
         print("-------------------------------------------------------------------------------------------------------------------------------------------")
         print(current_sound_data_line)
         print("-------------------------------------------------------------------------------------------------------------------------------------------")
      end

      for key, value in pairs(check_list) do
         for k, val in pairs(value) do
            if val == current_sound_data_line and key ~= current_level then
               for key2 in pairs(check_list) do
                  os.remove("data/current_sound/"..key2..".txt")
               end
               file = io.open("data/current_sound/"..key..".txt", "w")
               file:write()
               file:close()
               current_level = key
               print(key)
            end
         end
      end
      prev_value = sound_data
   end
end